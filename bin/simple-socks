#!/usr/bin/env node

'use strict';

var socks5 = require('../lib/socks5'),
    autostart = require('node-autostart'),
    argv_parser = require('minimist');

var KEY = 'simple-socks'

var args = argv_parser(process.argv.slice(2)),
    action = false,
    port = args.port || args.p || 1080,
    host = args.host || args.h || 'localhost';




if (args._.includes("start") && !action) {
    // run server and check required options
    socks5.createServer().listen(port, host, function () {
        console.log('SOCKS5 proxy server started on ' + host + ':' + port)
    })
    action = true
}

if (args._.includes("enable-autostart") && !action) {
    //enable
    autostart.enableAutostart(KEY, './simple-socks --port' + port + '--host' + host, process.cwd(), function (err) {
        if (err) console.error(err);
        console.log("Success adding socks5 server to autostart")
    })
    action = true
}

if (args._.includes("disable-autostart") && !action) {
    //disable autostart on launch of system
    autostart.disableAutostart(KEY, function (err) {
        if (err) console.error(err);
        console.log("Success disabel autostart this server on launch of system")
    })
    action = true
}

if (args._.includes("help") || args.help) {
    var l = console.log
    l(`
    === simple-socks ===
    help, --help: Show this information
    start: Run SOCKS5 proxy server
    enable-autostart: Add server to autostart (Note that options 'port', 'host' is required)
    disable-autostart: Remove this server from autostart on launch of system
    `)
    action = true
}

if (!action) {
    // Launch is incorrect
    console.log("Launch is incorrect")
}